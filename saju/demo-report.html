<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>?�주 리포??| AI ?�주 × MBTI</title>
    <meta name="description" content="AI ?�주 × MBTI ?�세 리포?? ?�주?�자(????????, ?�행 밸런?? ?�신/기신, ??��, MBTI ?�합까�? ??번에." />
    <meta name="robots" content="noindex,follow" />
    <link rel="canonical" href="https://im7873384-wq.github.io/jaehong-lotto/saju/" />

    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="?�홍 ?�주" />
    <meta property="og:title" content="?�주 리포??| AI ?�주 × MBTI" />
    <meta property="og:description" content="?�주?�자/?�행/?�신/??��/MBTI�??�쉽게�??�리??리포??" />
    <meta property="og:url" content="https://im7873384-wq.github.io/jaehong-lotto/saju/" />
    <meta property="og:image" content="https://im7873384-wq.github.io/jaehong-lotto/og/og-saju.svg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="?�주 리포??| AI ?�주 × MBTI" />
    <meta name="twitter:description" content="?�주?�자/?�행/?�신/??��/MBTI�??�쉽게�??�리??리포??" />
    <meta name="twitter:image" content="https://im7873384-wq.github.io/jaehong-lotto/og/og-saju.svg" />

    <link rel="stylesheet" href="../nav.css">

    <!-- ?�주 ?�진 로드 -->
    <script src="saju-engine.js"></script>
    <script src="personal-analysis.js"></script>

    <!-- 추�? ?�진 ?�전 로드 -->
    <script>
    (function() {
        const additionalScripts = [
            'enhanced-saju-engine.js',
            'professional-analysis.js'
        ];
        
        additionalScripts.forEach(scriptSrc => {
            try {
                const script = document.createElement('script');
                script.src = scriptSrc;
                script.onerror = function() {
                    console.warn(scriptSrc + ' 로드 ?�패 - 기본 기능?�로 ?�작');
                };
                document.head.appendChild(script);
            } catch (e) {
                console.warn(scriptSrc + ' 로드 �??�류:', e);
            }
        });
    })();
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif; 
            line-height: 1.7; 
            background: #f7f8fc; 
            color: #2c3e50;
        }

        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 30px 20px; 
        }

        /* ?�더 */
        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .report-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .report-header .user-info {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .score-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .score-item {
            background: rgba(255,255,255,0.15);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 100px;
        }

        .score-item .label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .score-item .value {
            font-size: 1.8rem;
            font-weight: 800;
        }

        /* 카드 ?��???*/
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .card h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-score {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .card-trend {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .card-desc {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .card.love { border-left-color: #ef4444; }
        .card.love h3, .card.love .card-score { color: #dc2626; }

        .card.career { border-left-color: #3b82f6; }
        .card.career h3, .card.career .card-score { color: #2563eb; }

        .card.wealth { border-left-color: #eab308; }
        .card.wealth h3, .card.wealth .card-score { color: #ca8a04; }

        .card.health { border-left-color: #22c55e; }
        .card.health h3, .card.health .card-score { color: #16a34a; }

        .trend-up { color: #059669; }
        .trend-stable { color: #6b7280; }
        .trend-down { color: #dc2626; }

        /* 분석 ?�션 */
        .analysis-section {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .analysis-section h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-section p {
            color: #4b5563;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .analysis-section ul {
            margin: 15px 0;
            padding-left: 20px;
        }

        .analysis-section li {
            margin-bottom: 8px;
            color: #4b5563;
        }

        /* ?�주?�자 ?�시 */
        .saju-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .pillar {
            background: #f8fafc;
            padding: 20px 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e5e7eb;
        }

        .pillar-title {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .pillar-chinese {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .pillar-korean {
            font-size: 0.9rem;
            color: #4b5563;
        }

        /* ?�행 �?*/
        .element-bars {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .element-bar {
            text-align: center;
        }

        .element-bar .label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .element-bar .bar-container {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .element-bar .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .element-bar .percentage {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .element-wood .label { color: #059669; }
        .element-wood .bar-fill { background: #059669; }
        .element-fire .label { color: #dc2626; }
        .element-fire .bar-fill { background: #dc2626; }
        .element-earth .label { color: #d97706; }
        .element-earth .bar-fill { background: #d97706; }
        .element-metal .label { color: #6b7280; }
        .element-metal .bar-fill { background: #6b7280; }
        .element-water .label { color: #0ea5e9; }
        .element-water .bar-fill { background: #0ea5e9; }

        /* 조언 그리??*/
        .advice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .advice-card {
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
        }

        .advice-card h4 {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .advice-card p {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #4b5563;
            margin: 0;
        }

        .advice-love { background: #fef2f2; border-left-color: #ef4444; }
        .advice-love h4 { color: #dc2626; }

        .advice-career { background: #eff6ff; border-left-color: #3b82f6; }
        .advice-career h4 { color: #2563eb; }

        .advice-wealth { background: #fefce8; border-left-color: #eab308; }
        .advice-wealth h4 { color: #ca8a04; }

        .advice-health { background: #f0fdf4; border-left-color: #22c55e; }
        .advice-health h4 { color: #16a34a; }

        /* 버튼 */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 40px 0 20px;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        /* ?�터 */
        .footer {
            text-align: center;
            padding: 30px;
            color: #9ca3af;
            font-size: 0.85rem;
        }

        /* 반응??*/
        @media (max-width: 768px) {
            .container { padding: 20px 15px; }
            .report-header { padding: 30px 20px; }
            .report-header h1 { font-size: 1.5rem; }
            .cards-grid { grid-template-columns: 1fr 1fr; }
            .saju-display { grid-template-columns: repeat(2, 1fr); }
            .element-bars { grid-template-columns: repeat(5, 1fr); gap: 8px; }
            .element-bar .label { font-size: 0.8rem; }
            .analysis-section { padding: 20px; }
            .advice-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .cards-grid { grid-template-columns: 1fr; }
            .score-display { flex-direction: column; align-items: center; }
        }

        /* ?�니메이??*/
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 로딩 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.1rem;
            color: #4b5563;
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <a href="/jaehong-lotto/">??/a>
        <a href="/jaehong-lotto/lotto/">로또</a>
        <a href="/jaehong-lotto/saju/">?�주</a>
    </nav>

    <!-- 로딩 ?�버?�이 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">?�� ?�주 분석 �?..</p>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <!-- ?�더 -->
        <div class="report-header fade-in">
            <h1 id="reportTitle">?�주 분석 결과</h1>
            <p class="user-info" id="userInfo"></p>

            <div style="margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                <button id="shareCopy" style="border:0; cursor:pointer; padding:10px 14px; border-radius:12px; font-weight:800; background:#ffffff; color:#4c1d95;">?�� 링크 복사</button>
                <a href="index.html" style="text-decoration:none; padding:10px 14px; border-radius:12px; font-weight:800; background:rgba(255,255,255,0.18); color:#fff; border:1px solid rgba(255,255,255,0.35);">?�️ ?�시 분석</a>
            </div>
            <div style="margin-top:10px; font-size:0.9rem; opacity:0.9;">공유?�서 친구??같이 보기</div>
            
            <div class="score-display">
                <div class="score-item">
                    <div class="label">종합 ?�세</div>
                    <div class="value" id="totalScore">--</div>
                </div>
                <div class="score-item">
                    <div class="label">?�애??/div>
                    <div class="value" id="headerLoveScore">--</div>
                </div>
                <div class="score-item">
                    <div class="label">직업??/div>
                    <div class="value" id="headerCareerScore">--</div>
                </div>
                <div class="score-item">
                    <div class="label">?�물??/div>
                    <div class="value" id="headerWealthScore">--</div>
                </div>
            </div>
        </div>

        <!-- ?�세 카드 -->
        <div class="cards-grid fade-in">
            <div class="card love">
                <h3>?�� ?�애??/h3>
                <div class="card-score" id="loveScore">--</div>
                <div class="card-trend" id="loveTrend">분석�?/div>
                <p class="card-desc" id="loveDesc">분석�?..</p>
            </div>
            
            <div class="card career">
                <h3>?�� 직업??/h3>
                <div class="card-score" id="careerScore">--</div>
                <div class="card-trend" id="careerTrend">분석�?/div>
                <p class="card-desc" id="careerDesc">분석�?..</p>
            </div>
            
            <div class="card wealth">
                <h3>?�� ?�물??/h3>
                <div class="card-score" id="wealthScore">--</div>
                <div class="card-trend" id="wealthTrend">분석�?/div>
                <p class="card-desc" id="wealthDesc">분석�?..</p>
            </div>
            
            <div class="card health">
                <h3>?�� 건강??/h3>
                <div class="card-score" id="healthScore">--</div>
                <div class="card-trend" id="healthTrend">분석�?/div>
                <p class="card-desc" id="healthDesc">분석�?..</p>
            </div>
        </div>

        <!-- ?�주?�자 -->
        <div class="analysis-section fade-in">
            <h3>?�� ?�주?�자 (?�柱?�字)</h3>
            <div class="saju-display" id="sajuDisplay">
                <div class="pillar">
                    <div class="pillar-title">?�주 (年柱)</div>
                    <div class="pillar-chinese" id="yearPillar">--</div>
                    <div class="pillar-korean" id="yearPillarKr">--</div>
                </div>
                <div class="pillar">
                    <div class="pillar-title">?�주 (?�柱)</div>
                    <div class="pillar-chinese" id="monthPillar">--</div>
                    <div class="pillar-korean" id="monthPillarKr">--</div>
                </div>
                <div class="pillar">
                    <div class="pillar-title">?�주 (?�柱)</div>
                    <div class="pillar-chinese" id="dayPillar">--</div>
                    <div class="pillar-korean" id="dayPillarKr">--</div>
                </div>
                <div class="pillar">
                    <div class="pillar-title">?�주 (?�柱)</div>
                    <div class="pillar-chinese" id="timePillar">--</div>
                    <div class="pillar-korean" id="timePillarKr">--</div>
                </div>
            </div>
            <p id="sajuSummary" style="margin-top: 20px; text-align: center; color: #4b5563;"></p>
        </div>

        <!-- ?�행 분석 -->
        <div class="analysis-section fade-in">
            <h3>?�️ ?�행 균형 분석</h3>
            <div class="element-bars">
                <div class="element-bar element-wood">
                    <div class="label">�???</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="woodBar" style="width: 0%"></div>
                    </div>
                    <div class="percentage" id="woodPercent">0%</div>
                </div>
                <div class="element-bar element-fire">
                    <div class="label">????</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="fireBar" style="width: 0%"></div>
                    </div>
                    <div class="percentage" id="firePercent">0%</div>
                </div>
                <div class="element-bar element-earth">
                    <div class="label">????</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="earthBar" style="width: 0%"></div>
                    </div>
                    <div class="percentage" id="earthPercent">0%</div>
                </div>
                <div class="element-bar element-metal">
                    <div class="label">�???</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="metalBar" style="width: 0%"></div>
                    </div>
                    <div class="percentage" id="metalPercent">0%</div>
                </div>
                <div class="element-bar element-water">
                    <div class="label">??�?</div>
                    <div class="bar-container">
                        <div class="bar-fill" id="waterBar" style="width: 0%"></div>
                    </div>
                    <div class="percentage" id="waterPercent">0%</div>
                </div>
            </div>
            <p id="elementSummary" style="margin-top: 15px; text-align: center; color: #4b5563;"></p>

            <div id="elementDeepDive" style="margin-top:16px; padding:16px; border-radius:14px; background:#f8fafc; border:1px solid #e5e7eb;">
                <div style="font-weight:900; color:#111827;">?�� ?�의 ?�행 밸런????번에 ?�리</div>
                <div id="elementDeepText" style="margin-top:10px; color:#374151; line-height:1.65; white-space:pre-line;">분석�?..</div>
                <div id="elementActionTip" style="margin-top:12px; font-weight:800; color:#4c1d95;">???�션?? 분석�?..</div>
            </div>
        </div>

        <!-- ?�격 분석 -->
        <div class="analysis-section fade-in">
            <h3>?�� ?�격 분석</h3>
            <div id="personalityAnalysis">
                <p>분석�?..</p>
            </div>
        </div>

        <!-- MBTI ?�동 -->
        <div class="analysis-section fade-in" id="mbtiSection" style="display: none;">
            <h3>?�� MBTI × ?�주 ?�합 분석</h3>
            <div id="mbtiAnalysis">
                <p>분석�?..</p>
            </div>
        </div>

        <!-- ??��(3�? -->
        <div class="analysis-section fade-in">
            <h3>?�� ???�주??캐릭????��)</h3>
            <div id="tenGodsAnalysis">
                <p>분석�?..</p>
            </div>
        </div>

        <!-- ?�신/기신 -->
        <div class="analysis-section fade-in">
            <h3>?�� ?�신 & 기신 분석</h3>
            <div id="yongsinAnalysis">
                <p>분석�?..</p>
            </div>
        </div>

        <!-- 맞춤 조언 -->
        <div class="analysis-section fade-in">
            <h3>�?맞춤 조언</h3>
            <div class="advice-grid">
                <div class="advice-card advice-love">
                    <h4>?�� ?�애 조언</h4>
                    <p id="loveAdvice">분석�?..</p>
                </div>
                <div class="advice-card advice-career">
                    <h4>?�� 직업 조언</h4>
                    <p id="careerAdvice">분석�?..</p>
                </div>
                <div class="advice-card advice-wealth">
                    <h4>?�� ?�물 조언</h4>
                    <p id="wealthAdvice">분석�?..</p>
                </div>
                <div class="advice-card advice-health">
                    <h4>?�� 건강 조언</h4>
                    <p id="healthAdvice">분석�?..</p>
                </div>
            </div>
        </div>

        <!-- 버튼 -->
        <div class="action-buttons">
            <a href="index.html" class="btn btn-primary">?�� ?�시 분석?�기</a>
            <button class="btn btn-secondary" onclick="shareResult()">?�� 결과 공유?�기</button>
        </div>

        <!-- ?�터 -->
        <div class="footer">
            <p>?�� ??분석 결과가 ?��????�셨?�요?</p>
            <p style="margin-top: 10px;">© 2024 AI ?�주 × MBTI. 모든 분석 결과??참고?�입?�다.</p>
        </div>
    </div>

    <script>
        // ?�더 "링크 복사" 버튼 바인??        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('shareCopy');
            if (btn) {
                btn.addEventListener('click', function() {
                    copyToClipboard(window.location.href);
                });
            }
        });

        // URL ?�라미터 ?�싱 (?��? ?�름 decodeURIComponent)
        function parseURLParameters() {
            const params = new URLSearchParams(window.location.search);
            const urlParams = {};
            
            for (const [key, value] of params.entries()) {
                try {
                    // name?� ?�중 ?�코?�되???�을 ???�음
                    if (key === 'name') {
                        try {
                            urlParams[key] = decodeURIComponent(decodeURIComponent(value));
                        } catch (e) {
                            urlParams[key] = decodeURIComponent(value);
                        }
                    } else {
                        urlParams[key] = decodeURIComponent(value);
                    }
                } catch (e) {
                    console.warn('URL ?�라미터 ?�코???�패:', key, value);
                    urlParams[key] = value;
                }
            }
            
            return urlParams;
        }

        // ?�렌???�스???�성
        function getTrendText(score) {
            if (score >= 85) return { text: '??매우 좋음', class: 'trend-up' };
            if (score >= 75) return { text: '???�승??, class: 'trend-up' };
            if (score >= 65) return { text: '???�정', class: 'trend-stable' };
            return { text: '??보통', class: 'trend-stable' };
        }

        // ?�세 ?�명 ?�성
        function getFortuneDescription(category, score) {
            const descriptions = {
                love: {
                    high: '좋�? 만남??기회가 ?��??�고 ?�습?�다. ?�신감을 가지?�요.',
                    mid: '기존 관계�? ?�욱 깊게 발전?�키?�데 집중?�세??',
                    low: '?�내?�이 ?�요???�기?�니?? ?�기 ?�신?�게 집중?�세??'
                },
                career: {
                    high: '?�로??기회가 찾아??것입?�다. ?�극?�으�??�전?�세??',
                    mid: '?�재 ?�태�??��??�며 꾸�???발전?�는 ?�기?�니??',
                    low: '?�중???�단???�요???�기?�니?? 준비에 집중?�세??'
                },
                wealth: {
                    high: '?�입 증�???기회가 보입?�다. ?�자�??�중??검?�하?�요.',
                    mid: '?�정?�인 ?�정 관리에 집중?�면 좋�? 결과가 ?�습?�다.',
                    low: '지�?관리에 ?�히 ?�경?�고, ?�축에 집중?�세??'
                },
                health: {
                    high: '?�반?�으�??�호?�니?? ?�발???�동??권장?�니??',
                    mid: '규칙?�인 관리�? ?�요?�니?? 건강 ?��????��??�세??',
                    low: '충분???�식�??�트?�스 관리에 ?�경?�세??'
                }
            };

            if (score >= 80) return descriptions[category].high;
            if (score >= 65) return descriptions[category].mid;
            return descriptions[category].low;
        }

        // 메인 분석 ?�행
        document.addEventListener('DOMContentLoaded', function() {
            const params = parseURLParameters();
            
            // ?�수 ?�라미터 체크
            if (!params.name || !params.year || !params.month || !params.day || !params.gender) {
                alert('?�수 ?�보가 ?�락?�었?�니?? ?�시 ?�력?�주?�요.');
                window.location.href = 'index.html';
                return;
            }

            // ?�이???�싱
            const userData = {
                name: params.name,
                year: parseInt(params.year),
                month: parseInt(params.month),
                day: parseInt(params.day),
                hour: params.hour === '-1' ? 12 : parseInt(params.hour), // 모름?�면 기본�?12??                gender: params.gender,
                mbti: params.mbti || null
            };

            console.log('?�용???�이??', userData);

            // 분석 ?�행 (?�간??지?�으�?로딩 ?�과)
            setTimeout(function() {
                runAnalysis(userData);
            }, 1000);
        });

        function runAnalysis(userData) {
            try {
                // ?�주 계산
                let sajuData = null;
                if (typeof calculateSaju === 'function') {
                    sajuData = calculateSaju(userData.year, userData.month, userData.day, userData.hour, userData.gender);
                    console.log('?�주 ?�이??', sajuData);
                }

                // 개인 분석 ?�성
                let analysisData = null;
                if (typeof generatePersonalAnalysis === 'function' && sajuData) {
                    const birthInfo = {
                        name: userData.name,
                        year: userData.year,
                        month: userData.month,
                        day: userData.day,
                        hour: userData.hour,
                        gender: userData.gender
                    };
                    analysisData = generatePersonalAnalysis(sajuData, userData.mbti || 'ENFP', birthInfo);
                    console.log('분석 ?�이??', analysisData);
                }

                // 결과 ?�시
                displayResults(userData, sajuData, analysisData);

            } catch (error) {
                console.error('분석 ?�류:', error);
                displayFallbackResults(userData);
            }

            // 로딩 ?�기�?콘텐�??�시
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }

        function displayResults(userData, sajuData, analysisData) {
            // ?�더 ?�보
            document.getElementById('reportTitle').textContent = userData.name + '?�의 ?�주 분석 결과';
            document.getElementById('userInfo').textContent = 
                (userData.gender === 'M' ? '?�성' : '?�성') + ' · ' +
                userData.year + '??' + userData.month + '??' + userData.day + '?�생' +
                (userData.mbti ? ' · ' + userData.mbti : '');

            // ?�수 계산 (분석 ?�이?��? ?�으�??�용, ?�으�?기본�?
            const scores = analysisData?.fortuneScores || {
                overall: 80,
                love: 78,
                career: 82,
                health: 75,
                wealth: 77
            };

            // ?�더 ?�수
            document.getElementById('totalScore').textContent = scores.overall;
            document.getElementById('headerLoveScore').textContent = scores.love;
            document.getElementById('headerCareerScore').textContent = scores.career;
            document.getElementById('headerWealthScore').textContent = scores.wealth;

            // 카드 ?�수 �??�명
            const categories = ['love', 'career', 'wealth', 'health'];
            categories.forEach(cat => {
                const score = scores[cat];
                const trend = getTrendText(score);
                
                document.getElementById(cat + 'Score').textContent = score;
                document.getElementById(cat + 'Trend').textContent = trend.text;
                document.getElementById(cat + 'Trend').className = 'card-trend ' + trend.class;
                document.getElementById(cat + 'Desc').textContent = getFortuneDescription(cat, score);
            });

            // ?�주?�자 ?�시
            if (sajuData && sajuData.pillars) {
                const pillars = sajuData.pillars;
                
                document.getElementById('yearPillar').textContent = pillars.year.chinese;
                document.getElementById('yearPillarKr').textContent = pillars.year.stemName + pillars.year.branchName;
                
                document.getElementById('monthPillar').textContent = pillars.month.chinese;
                document.getElementById('monthPillarKr').textContent = pillars.month.stemName + pillars.month.branchName;
                
                document.getElementById('dayPillar').textContent = pillars.day.chinese;
                document.getElementById('dayPillarKr').textContent = pillars.day.stemName + pillars.day.branchName;
                
                document.getElementById('timePillar').textContent = pillars.time.chinese;
                document.getElementById('timePillarKr').textContent = pillars.time.stemName + pillars.time.branchName;

                document.getElementById('sajuSummary').textContent = 
                    '?�간 ' + pillars.day.stemName + '(' + pillars.day.element + ')?�로, ' +
                    pillars.year.animal + '?�에 ?�어?�습?�다. ' +
                    '?�주??첫인???�경, ?�주???�회/?? ?�주?????�향(?�심), ?�주??미래/?�재?�을 봅니??';
            }

            // ?�행 분석 ?�시
            if (sajuData && sajuData.fiveElements) {
                const elements = sajuData.fiveElements.percentages;
                
                document.getElementById('woodBar').style.width = elements['�?] + '%';
                document.getElementById('woodPercent').textContent = elements['�?] + '%';
                
                document.getElementById('fireBar').style.width = elements['??] + '%';
                document.getElementById('firePercent').textContent = elements['??] + '%';
                
                document.getElementById('earthBar').style.width = elements['??] + '%';
                document.getElementById('earthPercent').textContent = elements['??] + '%';
                
                document.getElementById('metalBar').style.width = elements['�?] + '%';
                document.getElementById('metalPercent').textContent = elements['�?] + '%';
                
                document.getElementById('waterBar').style.width = elements['??] + '%';
                document.getElementById('waterPercent').textContent = elements['??] + '%';

                document.getElementById('elementSummary').textContent = 
                    sajuData.fiveElements.strongest + ' 기운??강하�? ' +
                    sajuData.fiveElements.weakest + ' 기운???�합?�다.';

                // 2) ?�행 밸런???�장(?�운 ?�명 + 루틴)
                const strong = sajuData.fiveElements.strongest;
                const weak = sajuData.fiveElements.weakest;
                const map = {
                    '�?: { title: '�??? 기운', good: '?�이?�어/?�장/관�??�장??강해. ?�작??빠르�? ?�람·기회가 ??붙는 ?�??', tooMuch: '근데 ?�심??커�?�??�만?��?�??�하??�??�”이 ?????�어.', add: '물건/?�정?� ?�시?�”보???�마감”을 먼�? ?�아주는 �?밸런?�에 ?��?.', routine: '매주 1개만 ?�끝?�기 ?�로?�트?�로 고정?�봐.' },
                    '??: { title: '???? 기운', good: '?�현/?�너지/?��??�이 강해. 분위�?메이�?+ 추진?�으�??�을 ?�우???�??', tooMuch: '과하�?감정기복/번아?�이 ?�기 ?�고, 말이 ?�서???�해가 ?�길 ???�어.', add: '?�너지�??�짧�?굵게???�고 ?�복 루틴???�식?�으�??�어????', routine: '??30�???+ 카페??컷오???�후 2??�??�도 체감 ?�라�?' },
                    '??: { title: '???? 기운', good: '?�정/조율/책임감이 강해. ?�?�서 중심 ?�고 ?�까지 가?��????�??', tooMuch: '과하�??�각??무거?��?�? 결정???�려�????�어(?�일??보류??.', add: '?�택지�?줄이�??�기준 1개”로 빨리 결정?�는 ?�습??좋음.', routine: '결정?�야 ???��? 10�??�?�머 걸고 결론 ?�리�?' },
                    '�?: { title: '�??? 기운', good: '?�단/?�리/기�????�렷?? ?�테?�·퀄리?�·효?�을 챙기???�??', tooMuch: '과하�??�카로워 보이거나 ?�벽주의�??�트?�스가 커질 ???�어.', add: '?�벽보다 ?�출?�→개선??루프�?가�??�히???�과가 빨라�?', routine: 'To-do???�초??60%)???�계�??�로 ?�어�?' },
                    '??: { title: '??�? 기운', good: '관�??�보/깊이가 강해. ?�름???�고 공�?/분석?�로 ??��?�는 ?�??', tooMuch: '과하�??�각??많아?�서 ?�동????���????�어(?�계??조사??.', add: '?��? ?�행??먼�? ?�고 ?�이?�로 보완?�는 �?밸런?�에 ?��?.', routine: '?�늘 ????1개는 ?�조???�이 바로 ?�행??룰로 ?�봐.' }
                };
                const s = map[strong] || map['??];
                const w = map[weak] || map['??];

                const deep = [
                    `강한 기운: ${strong} ??${s.good}`,
                    `주의(과하�?: ${s.tooMuch}`,
                    `?�한 기운: ${weak} ??${w.title}???�한 ?�이?? ${w.add}`
                ].join('\n\n');

                const action = `???�션?? ${w.routine}`;

                const deepEl = document.getElementById('elementDeepText');
                const actionEl = document.getElementById('elementActionTip');
                if (deepEl) deepEl.textContent = deep;
                if (actionEl) actionEl.textContent = action;
            }

            // ?�격 분석
            if (analysisData && analysisData.personality) {
                const personality = analysisData.personality;
                document.getElementById('personalityAnalysis').innerHTML = 
                    '<p><strong>' + personality.corePersonality + '</strong></p>' +
                    '<p style="margin-top: 15px;">' + (personality.detailedAnalysis || '').split('\n')[0] + '</p>';
            }

            // MBTI ?�동 분석 (5) ?�장
            if (userData.mbti) {
                document.getElementById('mbtiSection').style.display = 'block';
                const mbtiType = (userData.mbti || '').toUpperCase();
                
                // MBTI 그룹 ?�별
                const isE = mbtiType.charAt(0) === 'E';
                const isN = mbtiType.charAt(1) === 'N';
                const isT = mbtiType.charAt(2) === 'T';
                const isJ = mbtiType.charAt(3) === 'J';
                
                let group = '';
                if (isN && isT) group = 'NT';
                else if (isN && !isT) group = 'NF';
                else if (!isN && isT) group = 'ST';
                else group = 'SF';
                
                // 그룹�?+ E/I 조합 매핑
                const mbtiSajuMap = {
                    'NT': {
                        synergy: '?�리 + ?�주??직�? ???�략???�찰?�이 강함. ?�이??기반 결정???�주 ?�름 ?�?�밍 ?�하�??�너지 극�???',
                        conflict: '분석 과잉 주의. ?�주 조언 ?�무 ?�석?�려 ?��? 말고 "?�낌"???�뢰??',
                        love: '머리�??�랑 ?�해?�려 ?�면 ?�곤?�짐. 감정 ?�현?� "?�순?�게, ?�주" ?�는 �??�인??',
                        career: '기획/?�략/?�스???�계가 맞음. ?�?�선 비전 ?�시?�고 ?�테?��? ?�임??'
                    },
                    'NF': {
                        synergy: '공감??+ ?�주 ?�너지 리딩 ???�람 ?�악??빠름. 직감 믿어???? 거의 맞음.',
                        conflict: '감정 과몰??주의. ?�의 ?�너지???�들�???"??기운 리셋" ?�???�수.',
                        love: '?�상�??�실 �?�� 지�????�음. ?�벽???�애 ?�??"충분??좋�? ?�애"�?기�? ??��??OK.',
                        career: '?�담/교육/콘텐�??�리?�이?�브. ?��? ?�는 ?�이?�야 몰입 가??'
                    },
                    'ST': {
                        synergy: '?�행??+ ?�주 ?�?�밍 ??계획 ?�우�?밀?�붙?�는 ??최강. 루틴 + ?�세 ?�름 조합 추천.',
                        conflict: '?�통??부�?주의. ?�주가 "멈춰"???�도 ?�단 ?�려 ???��? ?�음. ?�론 ?�는 �??�략.',
                        love: '?�현 부족이 ?�해 만듦. 말보???�동 중시?��?�? 가??말로???�인?�줘????',
                        career: '?�영/?�무/?�무 매니�? ?�해�?목표 + 체계 ?�으�??�과 ?�실.'
                    },
                    'SF': {
                        synergy: '배려 + ?�주 ?�정 ?�너지 ???��?관계에???�뢰받는 존재. 조화 챙기면서 ?�장?�는 ?�??',
                        conflict: '거절 못해??번아?? "NO" ?�습 ?�수. ???�간부???�보?�고 ?�눠�?',
                        love: '?�신?�이???�연???�할 ???�음. "?�도 받는 ?�애"�?균형 맞추�?',
                        career: '?�비??케??HR/고객 ?��?. ?�람 ?�루???�에??빛남.'
                    }
                };
                
                // E/I???�른 추�? ??                const eiTip = isE 
                    ? '?�너지 충전???�람?�게???�니�? ?�극?�으�??�트?�킹?�고 ?�주 좋�? ??미팅/모임 ?�아.'
                    : '?�너지 충전???�자 ?�간?�서 ?�니�? ?�주 ??좋�? ?�엔 리트�?모드�??�환?�서 ?�복 ?�선.';
                
                const data = mbtiSajuMap[group] || mbtiSajuMap['SF'];
                
                document.getElementById('mbtiAnalysis').innerHTML = 
                    '<p style="font-weight:900; font-size:1.1rem; margin-bottom:14px;">?�� ' + mbtiType + ' × ?�주 ?�합</p>' +
                    '<div style="display:grid; gap:12px;">' +
                        '<div style="padding:12px 14px; background:#eff6ff; border-radius:10px; border-left:3px solid #3b82f6;">' +
                            '<div style="font-weight:800; color:#1d4ed8;">?�� ?�너지</div>' +
                            '<p style="margin:6px 0 0; color:#1e40af;">' + data.synergy + '</p>' +
                        '</div>' +
                        '<div style="padding:12px 14px; background:#fef3c7; border-radius:10px; border-left:3px solid #f59e0b;">' +
                            '<div style="font-weight:800; color:#b45309;">??충돌 ?�인??/div>' +
                            '<p style="margin:6px 0 0; color:#92400e;">' + data.conflict + '</p>' +
                        '</div>' +
                        '<div style="padding:12px 14px; background:#fce7f3; border-radius:10px; border-left:3px solid #ec4899;">' +
                            '<div style="font-weight:800; color:#be185d;">?�� ?�애</div>' +
                            '<p style="margin:6px 0 0; color:#9d174d;">' + data.love + '</p>' +
                        '</div>' +
                        '<div style="padding:12px 14px; background:#e0e7ff; border-radius:10px; border-left:3px solid #6366f1;">' +
                            '<div style="font-weight:800; color:#4338ca;">?�� ??커리??/div>' +
                            '<p style="margin:6px 0 0; color:#3730a3;">' + data.career + '</p>' +
                        '</div>' +
                    '</div>' +
                    '<p style="margin-top:14px; font-size:0.9rem; color:#6b7280;">' + (isE ? '?��' : '?��') + ' ' + eiTip + '</p>' +
                    '<p style="margin-top:12px; font-weight:800; color:#4c1d95;">???�션?? ?�늘 ' + group + ' 강점(' + (isT ? '?�리/?�단' : '공감/조율') + ')????번만 ?�식?�으�??�봐.</p>';
            } else if (analysisData && analysisData.mbtiSajuFusion) {
                // MBTI ?�이 analysisData�??�을 ??기존 로직 fallback
                document.getElementById('mbtiSection').style.display = 'block';
                const mbti = analysisData.mbtiSajuFusion;
                document.getElementById('mbtiAnalysis').innerHTML = 
                    '<p><strong>MBTI × ?�주 ?�합 분석</strong></p>' +
                    '<p style="margin-top: 10px;">' + mbti.compatibility + '</p>' +
                    '<p style="margin-top: 10px;">' + mbti.uniqueness + '</p>';
            }

            // 3) ??�� 분석(?�운 ?�약)
            if (sajuData && sajuData.tenGods) {
                const tg = sajuData.tenGods;
                const primary = tg.primary || '';
                const secondary = tg.secondary || '';

                const tenMap = {
                    '비견': { vibe: '???�이???�기주도', work: '?�자 몰입?�는 ?? 개인 ??�� 기반', rel: '?�등??관계에???�함. 간섭 ?�어??' },
                    '겁재': { vibe: '?��?/?�립/?�파', work: '????짜기, 경쟁/?�업/창업 기질', rel: '쿨한???�거?�. ?�존???��? 주의.' },
                    '?�신': { vibe: '꾸�????�산/?�행', work: '콘텐�??�작/기술, ?�아?�리????, rel: '배려?? ?�현???�실??' },
                    '?��?': { vibe: '?�현/개성/직설', work: '기획/마�????�리?�이?�브, 말로 먹고?�는', rel: '매력 강한???�폭 조절 ?�요.' },
                    '?�재': { vibe: '?�정/관�??�실�?, work: '?�영/?�계/PM, ?��?�??�함', rel: '?�뢰 ?�는 ?�애. 계획??' },
                    '?�재': { vibe: '기회/?�장/?�교', work: '?�업/?�자/?�업, ???�우�?, rel: '?��??????�애. 충동지�?주의.' },
                    '?��?': { vibe: '규칙/책임/?�실', work: '조직/공공/리더?? 맡�? ???�까지', rel: '?�속 중요. ?�정?�인 관�??�호.' },
                    '?��?': { vibe: '카리?�마/결단/?�박', work: '?�기관�??��?�?강함, 강한 리더', rel: '?�고 가???�?? 고집/강압 주의.' },
                    '?�인': { vibe: '?�습/?�리/보호', work: '?�구/분석/기획, 공�?�???��', rel: '?�뜻?�데 ?�자 ?�복 ?�간 ?�요.' },
                    '?�인': { vibe: '직감/?�이??몰입', work: '?�특???�문?? ?�방???�이?�어', rel: '취향 ?�고. ?�해받으�?깊게 �?' }
                };

                const p = tenMap[primary] || tenMap['?��?'];
                const s = tenMap[secondary] || tenMap['비견'];

                const html = `
                    <p style="font-weight:900;">?�� ?�심 캐릭?? <span class="mono">${primary || '?��?'}</span> + <span class="mono">${secondary || '비견'}</span></p>
                    <p style="margin-top:12px; color:#374151; line-height:1.65;">
                        <strong>??�??�약:</strong> ${p.vibe} ?�향??기본?�고, ${s.vibe} 기질??보조�?깔려?�어.
                    </p>
                    <p style="margin-top:10px; color:#374151; line-height:1.65;">
                        <strong>??커리??</strong> ${p.work}
                    </p>
                    <p style="margin-top:10px; color:#374151; line-height:1.65;">
                        <strong>?�애/관�?</strong> ${p.rel}
                    </p>
                    <p style="margin-top:12px; font-weight:800; color:#4c1d95;">???�션?? ${primary} 기운?� ?�장?�이 과하�??�점?�이 ?? ?�늘?� ??가지(�???결정)�??�조?�’해�?</p>
                `;

                const el = document.getElementById('tenGodsAnalysis');
                if (el) el.innerHTML = html;
            }

            // ?�신/기신 분석
            if (sajuData && sajuData.yongsinGisin) {
                const yg = sajuData.yongsinGisin;
                
                // (4) ?�신 기반 ?�천??매핑
                const yongsinTipMap = {
                    '�?: { colors: ['초록', '민트', '�?��'], time: '?�전 5~7??묘시) 기상 루틴', rhythm: '?�침 ?�트?�칭/?�책', action: '?�늘 ?�물 ??�?만�?거나 공원 ?�깐 걸어�?' },
                    '??: { colors: ['빨강', '?�크', '?�렌지'], time: '?�전 9~11???�시) 중요 미팅', rhythm: '?�심 ???�심 ?�무 몰입', action: '?�늘 빨간???�인???�이???�나 착용?�봐.' },
                    '??: { colors: ['베이지', '브라??, '?�로??], time: '?�후 1~3??미시) 계획 ?�리', rhythm: '?�후 ?�깐 멍때리기(?�화 �?리셋)', action: '?�늘 ?��? ?�식(바나?? ?�수?? ?�나 먹어�?' },
                    '�?: { colors: ['?�이??, '?�버', '그레??], time: '?�후 5~7???�시) ?�리/마감', rhythm: '?�?�에 ?�루 ?�리 ?�트 5�?, action: '?�늘 ???�는 물건 ?�나 ?�리?�거??버려�?' },
                    '??: { colors: ['블랙', '?�이�?, '블루'], time: '�?9~11???�시) 공�?/계획', rhythm: '?�기 ???�일 ????1개만 ?�기', action: '?�늘 �???????마시�? 조용???�간 10�??�보??' }
                };
                const tip = yongsinTipMap[yg.yongsin] || yongsinTipMap['??];
                
                document.getElementById('yongsinAnalysis').innerHTML = 
                    '<p><strong>?�� ?�신(?�神): ' + yg.yongsin + '</strong> - ?�신?�게 ?��????�는 기운?�니??</p>' +
                    '<p style="margin-top: 10px;"><strong>?�️ 기신(忌神): ' + yg.gisin + '</strong> - 주의?�야 ??기운?�니??</p>' +
                    '<p style="margin-top: 15px;">' + yg.yongsin + ' 기운???�극 ?�용?�고, ' + yg.gisin + ' 기운?� ?�절??조절?�여 균형??맞추?�요.</p>' +
                    '<div style="margin-top:18px; padding:16px; border-radius:14px; background:linear-gradient(135deg,#f0fdf4 0%,#ecfdf5 100%); border:1px solid #86efac;">' +
                        '<div style="font-weight:900; color:#166534; margin-bottom:10px;">?�� ' + yg.yongsin + ' ?�신 ?�천??/div>' +
                        '<p style="margin:6px 0; color:#15803d;"><strong>추천 ??</strong> ' + tip.colors.join(', ') + '</p>' +
                        '<p style="margin:6px 0; color:#15803d;"><strong>?�간/리듬:</strong> ' + tip.time + ' · ' + tip.rhythm + '</p>' +
                        '<p style="margin:10px 0 0; font-weight:800; color:#4c1d95;">???�늘 바로: ' + tip.action + '</p>' +
                    '</div>';
            }

            // 맞춤 조언
            document.getElementById('loveAdvice').textContent = 
                analysisData?.compatibilityAnalysis?.romantic?.general || 
                '?�로??차이?�을 ?�정?�고 존중?�는 관계�? 좋습?�다.';
            
            document.getElementById('careerAdvice').textContent = 
                analysisData?.careerGuidance?.aptitude?.substring(0, 100) || 
                '꾸�????�력�?발전??좋�? 결과�?가?�올 것입?�다.';
            
            document.getElementById('wealthAdvice').textContent = 
                '계획?�인 ?�정 관리�? ?�중???�자�?권장?�니??';
            
            document.getElementById('healthAdvice').textContent = 
                analysisData?.healthAnalysis?.recommendations?.lifestyle || 
                '규칙?�인 ?�활�??�절???�동?�로 건강???��??�세??';
        }

        // ?�백 결과 (?�진 로드 ?�패??
        function displayFallbackResults(userData) {
            document.getElementById('reportTitle').textContent = userData.name + '?�의 ?�주 분석 결과';
            document.getElementById('userInfo').textContent = 
                (userData.gender === 'M' ? '?�성' : '?�성') + ' · ' +
                userData.year + '??' + userData.month + '??' + userData.day + '?�생';

            // 기본 ?�수
            const baseScore = (userData.year + userData.month + userData.day) % 20 + 75;
            document.getElementById('totalScore').textContent = baseScore;
            document.getElementById('headerLoveScore').textContent = baseScore - 2;
            document.getElementById('headerCareerScore').textContent = baseScore + 1;
            document.getElementById('headerWealthScore').textContent = baseScore - 1;

            document.getElementById('loveScore').textContent = baseScore - 2;
            document.getElementById('careerScore').textContent = baseScore + 1;
            document.getElementById('wealthScore').textContent = baseScore - 1;
            document.getElementById('healthScore').textContent = baseScore;

            document.getElementById('personalityAnalysis').innerHTML = 
                '<p>?�신?� ?�특??매력�??�재?�을 가�?분입?�다. ?�신만의 강점??발휘?�여 목표�??�해 ?�아가?�요.</p>';
        }

        // 결과 공유
        function shareResult() {
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: '?�� AI ?�주 × MBTI 분석 결과',
                    text: '?�의 ?�주 분석 결과�??�인?�보?�요!',
                    url: url
                }).catch(function() {
                    copyToClipboard(url);
                });
            } else {
                copyToClipboard(url);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    alert('?�� 링크가 ?�립보드??복사?�었?�니??');
                });
            } else {
                prompt('링크�?복사?�세??', text);
            }
        }
    </script>
</body>
</html>
